{% extends "base.html" %}

{% block title %}{{ cat.name }}{% endblock %}

{% block content %}
<div class="bg-white shadow rounded-lg p-6">
    <h1 class="text-3xl font-bold mb-4">{{ cat.name }}</h1>
    {% if user.is_authenticated %}
        <a href="{% url 'cat_edit' cat.pk %}"
        class="inline-block mt-4 px-4 py-2 bg-yellow-500 text-white rounded hover:bg-yellow-600">
            Edit Cat Details
        </a>
    {% endif %}
    <div 
        x-data="{
            active: 0,
            lightbox: false,
            images: [
                {% for image in cat.images.all %}
                {
                    url: '{{ image.image.url }}',
                    caption: '{{ image.caption|escapejs }}'
                },
                {% endfor %}
            ],
            next() { this.active = (this.active + 1) % this.images.length },
            prev() { this.active = (this.active - 1 + this.images.length) % this.images.length },
            leftIndex() { return (this.active - 1 + this.images.length) % this.images.length },
            rightIndex() { return (this.active + 1) % this.images.length }
        }"
        class="relative max-w-3xl mx-auto select-none"
        @keydown.window="
            if ($event.key === 'ArrowRight') next();
            if ($event.key === 'ArrowLeft') prev();
        "
    >

        <!-- CAROUSEL WRAPPER -->
        <div class="flex items-center justify-center gap-4">

            <!-- LEFT BLURRED IMAGE -->
            <div class="w-1/4">
                <img 
                    :src="images[leftIndex()].url"
                    class="w-full h-64 object-contain opacity-40 blur-sm"
                >
            </div>

            <!-- MAIN IMAGE (click to open lightbox) -->
            <div 
                class="w-2/4 relative"
                @click="lightbox = true"
                @touchstart="touchStart = $event.changedTouches[0].clientX"
                @touchend="
                    touchEnd = $event.changedTouches[0].clientX;
                    if (touchEnd < touchStart - 50) next();
                    if (touchEnd > touchStart + 50) prev();
                "
            >
                <img 
                    :src="images[active].url"
                    class="w-full max-h-[600px] object-contain rounded shadow cursor-pointer"
                >
                <p class="text-center text-sm text-gray-600 mt-2" x-text="images[active].caption"></p>
            </div>

            <!-- RIGHT BLURRED IMAGE -->
            <div class="w-1/4">
                <img 
                    :src="images[rightIndex()].url"
                    class="w-full h-64 object-contain opacity-40 blur-sm"
                >
            </div>

        </div>

        <!-- NAV BUTTONS -->
        <div class="flex justify-between mt-4">
            <button 
                @click="prev()"
                class="px-4 py-2 bg-gray-300 rounded hover:bg-gray-400"
            >
                ← Prev
            </button>

            <button 
                @click="next()"
                class="px-4 py-2 bg-gray-300 rounded hover:bg-gray-400"
            >
                Next →
            </button>
        </div>

        <!-- LIGHTBOX -->
        <div 
            x-show="lightbox"
            x-transition
            class="fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50"
            @click.self="lightbox = false"
        >
            <div class="relative max-w-3xl w-full px-4">
                <img 
                    :src="images[active].url" 
                    class="w-full max-h-[90vh] object-contain rounded"
                >
                <button 
                    @click="lightbox = false"
                    class="absolute top-4 right-4 text-white text-3xl"
                >
                    &times;
                </button>
            </div>
        </div>

    </div>

    <p><strong>Breed:</strong> {{ cat.breed }}</p>
    <p><strong>Age:</strong> {{ cat.age }}</p>
    <p><strong>Colour:</strong> {{ cat.colour }}</p>
    <p><strong>Sex:</strong> {{ cat.get_sex_display }}</p>
    <p><strong>Status:</strong> {{ cat.get_status_display }}</p>
    <p><strong>Fostered In:</strong> {{ cat.fostered_in }}</p>

    <div class="mt-4">
        <h2 class="text-xl font-semibold mb-2">Description</h2>
        <p>{{ cat.description|linebreaks }}</p>
    </div>

    <div class="space-y-3">
        <!-- Vaccinated -->
        <div class="flex items-start gap-3">
            <span class="text-xl">
                {% if cat.is_vaccinated %}✓{% else %}✗{% endif %}
            </span>
            <div>
                <strong>Vaccinated</strong>
                {% if cat.vaccinated_notes %}
                    <p class="text-gray-600 text-sm">{{ cat.vaccinated_notes }}</p>
                {% endif %}
            </div>
        </div>

        <!-- Microchipped -->
        <div class="flex items-start gap-3">
            <span class="text-xl">
                {% if cat.is_microchipped %}✓{% else %}✗{% endif %}
            </span>
            <div>
                <strong>Microchipped</strong>
            </div>
        </div>

        <!-- Sterilised -->
        <div class="flex items-start gap-3">
            <span class="text-xl">
                {% if cat.is_sterilised %}✓{% else %}✗{% endif %}
            </span>
            <div>
                <strong>Sterilised</strong>
            </div>
        </div>

        <!-- FIV -->
        <div class="flex items-start gap-3">
            <span class="text-xl">
                {% if cat.is_fiv_positive %}✓{% else %}✗{% endif %}
            </span>
            <div>
                <strong>FIV Status</strong>
                {% if cat.health_notes %}
                    <p class="text-gray-600 text-sm">{{ cat.health_notes }}</p>
                {% endif %}
            </div>
        </div>

        <!-- Good with kids -->
        <div class="flex items-start gap-3">
            <span class="text-xl">
                {% if cat.is_good_with_kids %}✓{% else %}✗{% endif %}
            </span>
            <div>
                <strong>Good with kids</strong>
                {% if cat.good_with_kids_notes %}
                    <p class="text-gray-600 text-sm">{{ cat.good_with_kids_notes }}</p>
                {% endif %}
            </div>
        </div>

        <!-- Good with dogs -->
        <div class="flex items-start gap-3">
            <span class="text-xl">
                {% if cat.is_good_with_dogs %}✓{% else %}✗{% endif %}
            </span>
            <div>
                <strong>Good with dogs</strong>
                {% if cat.good_with_dogs_notes %}
                    <p class="text-gray-600 text-sm">{{ cat.good_with_dogs_notes }}</p>
                {% endif %}
            </div>
        </div>

        <!-- Good with cats -->
        <div class="flex items-start gap-3">
            <span class="text-xl">
                {% if cat.is_good_with_cats %}✓{% else %}✗{% endif %}
            </span>
            <div>
                <strong>Good with cats</strong>
                {% if cat.good_with_cats_notes %}
                    <p class="text-gray-600 text-sm">{{ cat.good_with_cats_notes }}</p>
                {% endif %}
            </div>
        </div>

    </div>
</div>
{% endblock %}